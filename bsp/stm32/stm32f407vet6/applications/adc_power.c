/****************************************************************************
 *
 * File Name：
 *  
 * Author：
 *  
 * Date：
 * 
 * Descriptions:
 * 
 *
 ******************************************************************************/
/*----------------------------------------------------------------------------*
**                             Dependencies                                   *
**----------------------------------------------------------------------------*/
#include <rtthread.h>
#include <rtdevice.h>

/**---------------------------------------------------------------------------*
 **                            Debugging Flag                                 *
 **---------------------------------------------------------------------------*/

/**---------------------------------------------------------------------------*
**                             Compiler Flag                                  *
**----------------------------------------------------------------------------*/
#ifdef __cplusplus
extern   "C"
{
#endif

/*----------------------------------------------------------------------------*
**                             Mcaro Definitions                              *
**----------------------------------------------------------------------------*/
#define ADC_DEV_NAME				"adc1"
#define ADC_DEV_CHANNEL				1
/*----------------------------------------------------------------------------*
**                             Data Structures                                *
**----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*
**                             Local Vars                                     *
**----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*
**                             Extern Function                                *
**----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*
**                             Local Function                                 *
**----------------------------------------------------------------------------*/
static int adc_vol_sample(int argc, char *argv[])
{
	rt_adc_device_t adc_dev;
	rt_uint32_t value,vol,real;
	
	rt_err_t ret = RT_EOK;
	
	//查找设备
	adc_dev = (rt_adc_device_t)rt_device_find(ADC_DEV_NAME);
	if(adc_dev == RT_NULL)
	{
		rt_kprintf("adc sample run failed! cannot find %s device !\n",ADC_DEV_NAME);
		return RT_ERROR;
	}
	//使能设备
	ret = rt_adc_enable(adc_dev,ADC_DEV_CHANNEL);
	
	//读取采样值
	value = rt_adc_read(adc_dev,ADC_DEV_CHANNEL);
	rt_kprintf("the value is :%d\n",value);
	
	//转换为对应电压值12位最大4096,数据精度乘以100保留2位小数
	vol = value * 330  / 4096;
	rt_kprintf("the voltage is : %d.%02d\n",vol / 100,vol % 100);
	real = vol *(4.2/3.3)* 2 ;
	rt_kprintf("the real voltage is : %d.%02d\n",real / 100,real % 100);	
	
	//关闭通道
	ret = rt_adc_disable(adc_dev,ADC_DEV_CHANNEL);
	
	return ret;	
}

MSH_CMD_EXPORT(adc_vol_sample,adc_power_test);
/*----------------------------------------------------------------------------*
**                             Public Function                                *
**----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*
**                             Function Define                                *
**----------------------------------------------------------------------------*/
/*************************************************
* Function:
* Description:
* Author:
* Returns: 
* Parameter:
* History:
*************************************************/




/**---------------------------------------------------------------------------*
 **                         Compiler Flag                                     *
 **---------------------------------------------------------------------------*/
#ifdef   __cplusplus
}
#endif
// End of xxx.c

