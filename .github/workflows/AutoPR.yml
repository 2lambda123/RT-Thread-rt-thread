name: "auto sync gitee_master"
on:
  # Runs at 16:00 UTC (BeiJing 00:00) on the 1st of every month
  schedule:
    - cron:  '0 16 1 * *'
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
            ssh-key: ${{ secrets.LOCAL_PRIVATE_KEY }}

      - name: Set up Python
        uses: actions/setup-python@master
        with:
          python-version: 3.8
          
      - name: Pull request
        shell: bash
        run: |
          git config --global user.name  'thread-liu'
          git config --global user.email 'lk9608@outlook.com' 
          git remote add rtt_github https://github.com/RT-Thread/rt-thread
          git remote add rtt_gitee https://gitee.com/rtthread/rt-thread
          git fetch rtt_github master:rtt_github 
          git fetch rtt_gitee gitee_master:rtt_gitee
          git checkout -b dev origin/master
          git branch -D master
          git checkout -b master rtt_github/master
          git merge rtt_gitee/gitee_master

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: rtthread-bot
          committer: GitHub <thread-liu@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.thread-liu.github.com>
          signoff: false
          branch: bot-branch
          delete-branch: true
          title: '[auto pr] rtthread-bot'
          body: |
            Update report
            - Updated with *today's* date
            - Auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          labels: |
            report
            automated pr
          assignees: thread-liu
          reviewers: thread-liu
          team-reviewers: |
            owners
            maintainers
          draft: false

      - name: Check outputs
        run: |
          echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
          echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
